<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>입을 옷이 없다고? : 패스트 패션 설문조사</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style id="jsbin-css">
        /* 설문 페이지 기본 스타일 */
        body {
            font-family: 'Inter', Arial, sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            background-color: #f0fdf4; /* 배경색 */
        }
        .background-gradient {
            min-height: 100vh;
            background: linear-gradient(135deg, #a8e063, #56ab2f, #2a8192); /* 연두색-청록색 그라데이션 */
            padding: 20px 0;
        }
        .container {
            max-width: 800px;
            margin: 40px auto;
            padding: 30px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            border-bottom: 2px solid #5cb85c;
            padding-bottom: 10px;
        }
        fieldset {
            border: 1px solid #ccc;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 8px;
        }
        legend {
            font-size: 1.1em;
            font-weight: bold;
            color: #0d8349; 
            padding: 0 10px;
        }
        label {
            display: block;
            margin-bottom: 10px;
            cursor: pointer;
        }
        input[type="radio"] {
            margin-right: 10px;
        }
        #submitBtn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #submitBtn:hover {
            background-color: #45a049;
        }
        
        /* Modal Style (팝업) */
        .modal {
            display: none; /* 초기에는 숨김 */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 30px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .modal-content h3 {
            color: #28a745;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        /* 분류 배너 스타일 */
        .classification-banner {
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .classification-banner h3 {
            font-size: 2em;
            margin-top: 5px;
            margin-bottom: 5px;
        }
        .classification-banner p {
            font-size: 1.1em;
            color: rgba(255, 255, 255, 0.9);
        }
    </style>
</head>
<body>
    <div class="background-gradient">
        <div class="container">
            <!-- 1. 설문 섹션 (ID: surveySection) -->
            <div id="surveySection"> 
                <h1>입을 옷이 없다고? : 패스트 패션 설문조사</h1>
                <form id="surveyForm">
                    <!-- 설문 항목 1~5 (기존 내용) -->
                    <fieldset>
                        <legend>1. 옷을 얼마나 구매하시나요?</legend>
                        <label><input type="radio" name="q1" value="일주일" required> 일주일</label><br>
                        <label><input type="radio" name="q1" value="한달"> 한달</label><br>
                        <label><input type="radio" name="q1" value="3개월"> 3개월</label><br>
                        <label><input type="radio" name="q1" value="6개월"> 6개월</label><br>
                        <label><input type="radio" name="q1" value="1년 혹은 그 이상"> 1년 혹은 그 이상</label>
                    </fieldset>

                    <fieldset>
                        <legend>2. 한 번 구매시 몇 벌을 구매하시나요?</legend>
                        <label><input type="radio" name="q2" value="1벌" required> 1벌</label><br>
                        <label><input type="radio" name="q2" value="2~3벌"> 2~3벌</label><br>
                        <label><input type="radio" name="q2" value="4~5벌"> 4~5벌</label><br>
                        <label><input type="radio" name="q2" value="6벌 이상"> 6벌 이상</label>
                    </fieldset>

                    <fieldset>
                        <legend>3. 주로 어디서 구매하시나요?</legend>
                        <label><input type="radio" name="q3" value="온라인 쇼핑몰" required> 온라인 쇼핑몰</label><br>
                        <label><input type="radio" name="q3" value="브랜드 매장"> 브랜드 매장</label><br>
                        <label><input type="radio" name="q3" value="오프라인 편집샵, 보세"> 오프라인 편집샵, 보세</label><br>
                        <label><input type="radio" name="q3" value="중고 거래(온/오프라인)"> 중고 거래(온/오프라인)</label><br>
                        <label><input type="radio" name="q3" value="기타"> 기타</label>
                    </fieldset>

                    <fieldset>
                        <legend>4. 구매한 옷은 얼마나 오래 입나요?</legend>
                        <label><input type="radio" name="q4" value="1년 미만" required> 1년 미만</label><br>
                        <label><input type="radio" name="q4" value="2~3년"> 2~3년</label><br>
                        <label><input type="radio" name="q4" value="5년 이상"> 5년 이상</label><br>
                        <label><input type="radio" name="q4" value="망가지지 않는한 버리지 않는다"> 망가지지 않는한 버리지 않는다</label>
                    </fieldset>

                    <fieldset>
                        <legend>5. 패스트 패션에 대해 어느정도 알고계시나요?</legend>
                        <label><input type="radio" name="q5" value="잘 알고 있다" required> 잘 알고 있다</label><br>
                        <label><input type="radio" name="q5" value="어느정도 알고 있다"> 어느정도 알고 있다</label><br>
                        <label><input type="radio" name="q5" value="조금 알고 있다"> 조금 알고 있다</label><br>
                        <label><input type="radio" name="q5" value="잘 모른다"> 잘 모른다</label>
                    </fieldset>

                    <button type="submit" id="submitBtn">제출하기</button>
                </form>
            </div> 

            <!-- 2. 결과 섹션 (ID: resultSection) -->
            <div id="resultSection" style="display: none;">
            </div>

        </div>
    </div>
    
    <!-- 3. 제출 완료 모달 (ID: submissionModal) -->
    <div id="submissionModal" class="modal">
        <div class="modal-content">
            <h3>✅ 설문이 완료되었습니다!</h3>
            <p>실시간으로 집계된 다른 참여자들의 응답 결과를 확인하시겠습니까?</p>
            <button id="closeModalBtn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mt-4">
                결과 보기
            </button>
        </div>
    </div>
    
<script id="jsbin-javascript">
// 🚨 [필수 교체] 1. Google Apps Script 배포 시 얻은 Web App URL로 교체하세요.
const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxNHw3sRbzuOTtDL7jFxmPaOGVLtn9WaR792DryyyJTJ7FxsRF4iw3WwWS_B8sgQB5V/exec'; 

// 🚨 [필수 교체] 2. Google Sheets에서 차트 게시 후 얻은 iframe src 속성 값으로 교체하세요. (총 5개)
const CHART_EMBED_URL_Q1 = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRuD1zwZn-7ezRlEQdw_UHa1wlMeuGi6-IjQOhEmGVbZMFulx1dnWAmdnJ26b2xRSG5MS1LDKL25Q0R/pubchart?oid=2096894684&amp;format=interactive'; 
const CHART_EMBED_URL_Q2 = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRuD1zwZn-7ezRlEQdw_UHa1wlMeuGi6-IjQOhEmGVbZMFulx1dnWAmdnJ26b2xRSG5MS1LDKL25Q0R/pubchart?oid=1562599177&amp;format=interactive'; // OID를 실제 Q2 차트 OID로 교체해야 함
const CHART_EMBED_URL_Q3 = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRuD1zwZn-7ezRlEQdw_UHa1wlMeuGi6-IjQOhEmGVbZMFulx1dnWAmdnJ26b2xRSG5MS1LDKL25Q0R/pubchart?oid=1302991120&amp;format=interactive'; // OID를 실제 Q3 차트 OID로 교체해야 함
const CHART_EMBED_URL_Q4 = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRuD1zwZn-7ezRlEQdw_UHa1wlMeuGi6-IjQOhEmGVbZMFulx1dnWAmdnJ26b2xRSG5MS1LDKL25Q0R/pubchart?oid=479222045&amp;format=interactive'; // OID를 실제 Q4 차트 OID로 교체해야 함
const CHART_EMBED_URL_Q5 = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRuD1zwZn-7ezRlEQdw_UHa1wlMeuGi6-IjQOhEmGVbZMFulx1dnWAmdnJ26b2xRSG5MS1LDKL25Q0R/pubchart?oid=1669632818&amp;format=interactive'; // OID를 실제 Q5 차트 OID로 교체해야 함
    
let currentView = 'charts';
// 사용자의 분류 결과를 저장할 객체
let userClassification = {}; 

/**
 * 설문 응답을 기반으로 점수를 계산하고 사용자의 소비 성향을 분류합니다.
 */
function determineClassification(payload) {
    let score = 0;
    
    // Q1 (구매 빈도): 일주일(4) > 한달(3) > 3개월(2) > 6개월(1) > 1년 혹은 그 이상(0)
    const q1Scores = { '일주일': 4, '한달': 3, '3개월': 2, '6개월': 1, '1년 혹은 그 이상': 0 };
    score += q1Scores[payload.q1] || 0;

    // Q2 (구매 수량): 6벌 이상(3) > 4~5벌(2) > 2~3벌(1) > 1벌(0)
    const q2Scores = { '6벌 이상': 3, '4~5벌': 2, '2~3벌': 1, '1벌': 0 };
    score += q2Scores[payload.q2] || 0;

    // Q3 (구매처): 온라인 쇼핑몰(3) > 브랜드 매장(2) > 오프라인 편집샵, 보세(1) > 중고 거래(0) / 기타(1)
    const q3Scores = { '온라인 쇼핑몰': 3, '브랜드 매장': 2, '오프라인 편집샵, 보세': 1, '중고 거래(온/오프라인)': 0, '기타': 1 };
    score += q3Scores[payload.q3] || 0;
    
    // Q4 (옷 수명): 1년 미만(3) > 2~3년(2) > 5년 이상(1) > 망가지지 않는한 버리지 않는다(0)
    const q4Scores = { '1년 미만': 3, '2~3년': 2, '5년 이상': 1, '망가지지 않는한 버리지 않는다': 0 };
    score += q4Scores[payload.q4] || 0;

    // Q5 (인식 수준 - 역배점): 잘 모른다(3) > 조금 알고 있다(2) > 어느정도 알고 있다(1) > 잘 알고 있다(0)
    const q5Scores = { '잘 모른다': 3, '조금 알고 있다': 2, '어느정도 알고 있다': 1, '잘 알고 있다': 0 };
    score += q5Scores[payload.q5] || 0;

    // 총점 기준 분류 (Max Score: 16, Min Score: 0)
    let classification = { icon: '❓', title: '분류 실패', message: '데이터가 불충분합니다.', color: 'bg-gray-500' };

    if (score <= 5) {
        classification = { 
            icon: '🐢', 
            title: '슬로우 패션 실천자!', 
            message: '지속 가능한 소비 습관을 가지고 계십니다. 환경을 위한 당신의 노력을 응원합니다!',
            color: 'bg-green-600'
        };
    } else if (score <= 11) {
        classification = { 
            icon: '🚶‍♂️', 
            title: '보통의 소비자', 
            message: '합리적인 소비 습관을 가지고 있습니다. 조금 더 신경 써보는 건 어떨까요?',
            color: 'bg-blue-600'
        };
    } else { // score 12 ~ 16
        classification = { 
            icon: '🐆', 
            title: '패스트 패션 애호가', 
            message: '트렌드에 민감한 편입니다. 소비 습관이 환경에 미치는 영향을 고민해봅시다.',
            color: 'bg-red-600'
        };
    }
    
    return classification;
}

// 폼 제출 이벤트 리스너
document.getElementById('surveyForm').addEventListener('submit', function(event) {
    event.preventDefault();

    if (!this.checkValidity()) {
        return; 
    }

    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    submitBtn.textContent = '제출 중...';
    
    const formData = new FormData(this);
    
    const payload = {
        q1: formData.get('q1'),
        q2: formData.get('q2'),
        q3: formData.get('q3'),
        q4: formData.get('q4'),
        q5: formData.get('q5')
    };

    // 1. 사용자 분류 실행 및 저장
    userClassification = determineClassification(payload);
    
    console.log('[DEBUG] Payload to be sent:', payload);

    fetch(GOOGLE_APPS_SCRIPT_URL, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded' 
        },
        body: new URLSearchParams(payload)
    })
    .then(response => {
        console.log('Submission successful, status:', response.status);

        document.getElementById('submissionModal').style.display = 'flex';
        
        document.getElementById('closeModalBtn').onclick = () => {
            document.getElementById('submissionModal').style.display = 'none';
            showResultPage();
        };

        submitBtn.disabled = false;
        submitBtn.textContent = '제출하기';
    })
    .catch(error => {
        console.error('Network Error:', error);
        
        submitBtn.disabled = false;
        submitBtn.textContent = '제출하기';
    });
});

/**
 * 차트 iframe HTML 구조를 생성합니다.
 */
function generateChartHtml(chartUrl, title) {
    return `
        <div class="mt-8 pt-4 border-t border-gray-200">
            <h3 class="text-xl font-semibold text-gray-800 mb-4 text-center">${title}</h3>
            <div class="chart-area mb-8 shadow-lg rounded-lg overflow-hidden border border-gray-300">
                <iframe 
                    src="${chartUrl}"
                    width="100%" 
                    height="450" 
                    frameborder="0" 
                    loading="lazy"
                    allowfullscreen>
                </iframe>
            </div>
        </div>
    `;
}

/**
 * 사용자 분류 결과를 표시하는 배너 HTML을 생성합니다.
 */
function generateClassificationBanner(classification) {
    return `
        <div class="classification-banner ${classification.color} text-white">
            <span class="text-5xl">${classification.icon}</span>
            <h3 class="font-extrabold">${classification.title}</h3>
            <p>${classification.message}</p>
        </div>
    `;
}

/**
 * 결과 페이지의 레이아웃(네비게이션, 차트, 정보)을 초기 설정합니다. (딱 한 번만 실행)
 */
function initializeResultLayout(resultSection) {
    // 0. 분류 배너 설정 (가장 상단에 위치)
    const classificationBannerHtml = generateClassificationBanner(userClassification);

    // 1. Navigation Setup
    const navigationHtml = `
        <div id="resultNavigation" class="mb-8 flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-4 p-3 bg-gray-100 rounded-lg shadow-inner">
            <button id="navToCharts" class="nav-button bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200">
                📊 차트 결과 보기
            </button>
            <button id="navToInfo" class="nav-button bg-gray-400 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-lg transition duration-200">
                📜 패스트 패션 정보
            </button>
        </div>
    `;

    // 2. Chart Section Setup
    const chartHtml = `
        <div id="chartResults">
            <h2 class="text-3xl font-extrabold text-blue-800 text-center mb-6 pt-4">📊 설문조사 실시간 결과</h2>
            <p class="text-lg text-gray-700 text-center mb-8">
                Google Sheets에 수집된 설문조사 결과가 실시간으로 업데이트되는 그래프입니다.
            </p>
            
            <!-- 5개의 차트 섹션 -->
            ${generateChartHtml(CHART_EMBED_URL_Q1, "1. 옷을 얼마나 구매하시나요? (구매 빈도)")}
            ${generateChartHtml(CHART_EMBED_URL_Q2, "2. 한 번 구매 시 몇 벌을 구매하시나요? (구매 수량)")}
            ${generateChartHtml(CHART_EMBED_URL_Q3, "3. 주로 어디서 구매하시나요? (주요 구매처)")}
            ${generateChartHtml(CHART_EMBED_URL_Q4, "4. 구매한 옷은 얼마나 오래 입나요? (옷 수명)")}
            ${generateChartHtml(CHART_EMBED_URL_Q5, "5. 패스트 패션에 대해 어느정도 알고계시나요? (인식 수준)")}
            
            <p class="text-sm text-center text-gray-500 mt-2">차트는 Google Sheets의 데이터 업데이트 주기에 따라 반영됩니다.</p>
        </div>
    `;

    // 3. Info Section Setup (Enhanced Content)
    const infoHtml = `
        <div id="infoDetails" style="display: none;">
            <h2 class="text-3xl font-bold text-green-700 text-center mb-6 pt-4">📜 패스트 패션: 지속 가능성의 그림자</h2>
            <div class="space-y-6 text-gray-800 p-4 border rounded-lg bg-green-50">
                
                <h3 class="text-xl font-semibold text-green-600">1. 환경 오염 문제</h3>
                <p>
                    패스트 패션은 엄청난 양의 자원을 소모합니다. 특히 저렴한 합성 섬유인 폴리에스터는 제조 과정에서 석유를 사용하며, 세탁 시 미세 플라스틱을 배출하여 해양 생태계에 치명적인 영향을 줍니다. 또한 면화 생산에는 막대한 양의 물과 살충제가 필요하며, 짧은 주기로 버려지는 옷들은 매립지에서 분해되지 않고 환경에 장기적인 부담을 줍니다.
                </p>
                
                <h3 class="text-xl font-semibold text-green-600">2. 노동 착취 논란</h3>
                <p>
                    옷을 저렴하게, 그리고 빠르게 생산하기 위해 개발도상국의 노동자들은 비인간적인 환경에서 일하는 경우가 많습니다. 낮은 임금, 장시간 노동, 그리고 열악하고 위험한 작업 환경은 패스트 패션의 그림자입니다. 윤리적 소비가 강조되는 시대에, 소비자들은 자신이 입는 옷이 어떤 과정을 거쳐왔는지 주목할 필요가 있습니다.
                </p>
                
                <h3 class="text-xl font-semibold text-green-600">3. 과잉 소비 문화 조장</h3>
                <p>
                    패스트 패션은 '입을 옷이 없다'는 인식을 조장하며, 끊임없이 새로운 유행을 만들어 소비자가 불필요하게 옷을 구매하도록 유도합니다. 이로 인해 옷을 쉽게 버리는 습관이 생기고, 개인의 옷장뿐만 아니라 사회 전체의 지속 가능성에 악영향을 미칩니다. 옷의 가치를 존중하고 오래 입는 '슬로우 패션'으로의 전환이 중요해지고 있습니다.
                </p>
            </div>
            <p class="text-sm text-center text-gray-500 mt-8">자세한 정보는 관련 환경 및 노동 단체 자료를 참고하세요.</p>
        </div>
    `;

    // 배너, 네비게이션, 차트/정보 영역을 순서대로 삽입
    resultSection.innerHTML = classificationBannerHtml + navigationHtml + chartHtml + infoHtml;

    // 네비게이션 버튼에 이벤트 리스너 연결
    document.getElementById('navToCharts').addEventListener('click', () => updateResultView('charts'));
    document.getElementById('navToInfo').addEventListener('click', () => updateResultView('info'));
}


/**
 * 현재 뷰 상태에 따라 화면을 전환하고 네비게이션 버튼 스타일을 업데이트합니다.
 */
function updateResultView(view) {
    currentView = view;
    const chartDiv = document.getElementById('chartResults');
    const infoDiv = document.getElementById('infoDetails');
    const navChartsBtn = document.getElementById('navToCharts');
    const navInfoBtn = document.getElementById('navToInfo');
    
    if (view === 'charts') {
        chartDiv.style.display = 'block';
        infoDiv.style.display = 'none';
        
        // 차트 버튼 활성화 스타일
        navChartsBtn.classList.remove('bg-gray-400', 'hover:bg-gray-500');
        navChartsBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
        // 정보 버튼 비활성화 스타일
        navInfoBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
        navInfoBtn.classList.add('bg-gray-400', 'hover:bg-gray-500');
    } else { // view === 'info'
        chartDiv.style.display = 'none';
        infoDiv.style.display = 'block';

        // 차트 버튼 비활성화 스타일
        navChartsBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
        navChartsBtn.classList.add('bg-gray-400', 'hover:bg-gray-500');
        // 정보 버튼 활성화 스타일
        navInfoBtn.classList.remove('bg-gray-400', 'hover:bg-gray-500');
        navInfoBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
    }
    window.scrollTo(0, 0); 
}

/**
 * 설문조사 결과 페이지로 화면을 전환하고 Google Sheets의 차트를 표시합니다.
 */
function showResultPage() {
    // 설문 섹션 숨기기
    document.getElementById('surveySection').style.display = 'none';
    
    const resultSection = document.getElementById('resultSection');
    
    // 결과 섹션 내용이 초기화되지 않았다면 초기 레이아웃을 설정합니다.
    if (resultSection.children.length === 0) {
        initializeResultLayout(resultSection);
    }
    
    // 결과 섹션 보이기
    resultSection.style.display = 'block';

    // 현재 뷰 상태에 따라 화면을 업데이트 (기본값: 'charts')
    updateResultView(currentView);
}
</script>
</body>
</html>
