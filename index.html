<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>입을 옷이 없다고? : 패스트 패션 설문조사</title>
    <!-- Tailwind CSS CDN: 결과 페이지 스타일링을 위해 필수 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style id="jsbin-css">
        /* 설문 페이지 기본 스타일 */
        body {
            font-family: 'Inter', Arial, sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            background-color: #f0fdf4; /* 배경색 */
        }
        .background-gradient {
            min-height: 100vh;
            background: linear-gradient(135deg, #a8e063, #56ab2f, #2a8192); /* 연두색-청록색 그라데이션 */
            padding: 20px 0;
        }
        .container {
            max-width: 800px;
            margin: 40px auto;
            padding: 30px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            border-bottom: 2px solid #5cb85c;
            padding-bottom: 10px;
        }
        fieldset {
            border: 1px solid #ccc;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 8px;
        }
        legend {
            font-size: 1.1em;
            font-weight: bold;
            color: #0d8349; 
            padding: 0 10px;
        }
        label {
            display: block;
            margin-bottom: 10px;
            cursor: pointer;
        }
        input[type="radio"] {
            margin-right: 10px;
        }
        #submitBtn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #submitBtn:hover {
            background-color: #45a049;
        }
        
        /* Modal Style (팝업) */
        .modal {
            display: none; /* 초기에는 숨김 */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 30px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .modal-content h3 {
            color: #28a745;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
    </style>
</head>
<body>
    <div class="background-gradient">
        <div class="container">
            <!-- 1. 설문 섹션 (ID: surveySection) - 자바스크립트가 숨기려는 영역 -->
            <div id="surveySection"> 
                <h1>입을 옷이 없다고? : 패스트 패션 설문조사</h1>
                <form id="surveyForm">
                    <!-- 설문 항목 1~5 (생략된 내용) -->
                    <fieldset>
                        <legend>1. 옷을 얼마나 구매하시나요?</legend>
                        <label><input type="radio" name="q1" value="일주일" required> 일주일</label><br>
                        <label><input type="radio" name="q1" value="한달"> 한달</label><br>
                        <label><input type="radio" name="q1" value="3개월"> 3개월</label><br>
                        <label><input type="radio" name="q1" value="6개월"> 6개월</label><br>
                        <label><input type="radio" name="q1" value="1년 혹은 그 이상"> 1년 혹은 그 이상</label>
                    </fieldset>

                    <fieldset>
                        <legend>2. 한 번 구매시 몇 벌을 구매하시나요?</legend>
                        <label><input type="radio" name="q2" value="1벌" required> 1벌</label><br>
                        <label><input type="radio" name="q2" value="2~3벌"> 2~3벌</label><br>
                        <label><input type="radio" name="q2" value="4~5벌"> 4~5벌</label><br>
                        <label><input type="radio" name="q2" value="6벌 이상"> 6벌 이상</label>
                    </fieldset>

                    <fieldset>
                        <legend>3. 주로 어디서 구매하시나요?</legend>
                        <label><input type="radio" name="q3" value="온라인 쇼핑몰" required> 온라인 쇼핑몰</label><br>
                        <label><input type="radio" name="q3" value="브랜드 매장"> 브랜드 매장</label><br>
                        <label><input type="radio" name="q3" value="오프라인 편집샵, 보세"> 오프라인 편집샵, 보세</label><br>
                        <label><input type="radio" name="q3" value="중고 거래(온/오프라인)"> 중고 거래(온/오프라인)</label><br>
                        <label><input type="radio" name="q3" value="기타"> 기타</label>
                    </fieldset>

                    <fieldset>
                        <legend>4. 구매한 옷은 얼마나 오래 입나요?</legend>
                        <label><input type="radio" name="q4" value="1년 미만" required> 1년 미만</label><br>
                        <label><input type="radio" name="q4" value="2~3년"> 2~3년</label><br>
                        <label><input type="radio" name="q4" value="5년 이상"> 5년 이상</label><br>
                        <label><input type="radio" name="q4" value="망가지지 않는한 버리지 않는다"> 망가지지 않는한 버리지 않는다</label>
                    </fieldset>

                    <fieldset>
                        <legend>5. 패스트 패션에 대해 어느정도 알고계시나요?</legend>
                        <label><input type="radio" name="q5" value="잘 알고 있다" required> 잘 알고 있다</label><br>
                        <label><input type="radio" name="q5" value="어느정도 알고 있다"> 어느정도 알고 있다</label><br>
                        <label><input type="radio" name="q5" value="조금 알고 있다"> 조금 알고 있다</label><br>
                        <label><input type="radio" name="q5" value="잘 모른다"> 잘 모른다</label>
                    </fieldset>

                    <button type="submit" id="submitBtn">제출하기</button>
                </form>
            </div> 

            <!-- 2. 결과 섹션 (ID: resultSection) - 자바스크립트가 차트 및 정보를 로드할 빈 영역, 초기에는 숨김 -->
            <!-- 이 섹션 안에 네비게이션 버튼, 차트 영역, 정보 영역이 삽입됩니다. -->
            <div id="resultSection" style="display: none;">
            </div>

        </div>
    </div>
    
    <!-- 3. 제출 완료 모달 (ID: submissionModal) - 자바스크립트가 보여줄 팝업 창 -->
    <div id="submissionModal" class="modal">
        <div class="modal-content">
            <h3>✅ 설문이 완료되었습니다!</h3>
            <p>실시간으로 집계된 다른 참여자들의 응답 결과를 확인하시겠습니까?</p>
            <!-- 팝업 내 버튼 (ID: closeModalBtn) - 클릭 시 결과 페이지로 전환 -->
            <button id="closeModalBtn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mt-4">
                결과 보기
            </button>
        </div>
    </div>
    
<script id="jsbin-javascript">
// 🚨 [필수 교체] 1. Google Apps Script 배포 시 얻은 Web App URL로 교체하세요.
const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxNHw3sRbzuOTtDL7jFxmPaOGVLtn9WaR792DryyyJTJ7FxsRF4iw3WwWS_B8sgQB5V/exec'; 

// 🚨 [필수 교체] 2. Google Sheets에서 차트 게시 후 얻은 iframe src 속성 값으로 교체하세요. (총 5개)
// 아래 URL은 예시입니다. 각 질문별로 '웹에 게시' 기능을 사용하여 OID를 다르게 설정해야 합니다.
const CHART_EMBED_URL_Q1 = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRuD1zwZn-7ezRlEQdw_UHa1wlMeuGi6-IjQOhEmGVbZMFulx1dnWAmdnJ26b2xRSG5MS1LDKL25Q0R/pubchart?oid=2096894684&amp;format=interactive'; 
const CHART_EMBED_URL_Q2 = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRuD1zwZn-7ezRlEQdw_UHa1wlMeuGi6-IjQOhEmGVbZMFulx1dnWAmdnJ26b2xRSG5MS1LDKL25Q0R/pubchart?oid=1562599177&amp;format=interactive'; // OID를 실제 Q2 차트 OID로 교체해야 함
const CHART_EMBED_URL_Q3 = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRuD1zwZn-7ezRlEQdw_UHa1wlMeuGi6-IjQOhEmGVbZMFulx1dnWAmdnJ26b2xRSG5MS1LDKL25Q0R/pubchart?oid=1302991120&amp;format=interactive'; // OID를 실제 Q3 차트 OID로 교체해야 함
const CHART_EMBED_URL_Q4 = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRuD1zwZn-7ezRlEQdw_UHa1wlMeuGi6-IjQOhEmGVbZMFulx1dnWAmdnJ26b2xRSG5MS1LDKL25Q0R/pubchart?oid=479222045&amp;format=interactive'; // OID를 실제 Q4 차트 OID로 교체해야 함
const CHART_EMBED_URL_Q5 = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRuD1zwZn-7ezRlEQdw_UHa1wlMeuGi6-IjQOhEmGVbZMFulx1dnWAmdnJ26b2xRSG5MS1LDKL25Q0R/pubchart?oid=1669632818&amp;format=interactive'; // OID를 실제 Q5 차트 OID로 교체해야 함
    
// 현재 보고 있는 결과 페이지 뷰 상태 ('charts' 또는 'info')
let currentView = 'charts';

// 폼 제출 이벤트 리스너
document.getElementById('surveyForm').addEventListener('submit', function(event) {
    event.preventDefault();

    // 폼 유효성 검사
    if (!this.checkValidity()) {
        return; 
    }

    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    submitBtn.textContent = '제출 중...';
    
    const formData = new FormData(this);
    
    // 전송할 데이터 객체 구성
    const payload = {
        q1: formData.get('q1'),
        q2: formData.get('q2'),
        q3: formData.get('q3'),
        q4: formData.get('q4'),
        q5: formData.get('q5')
    };
    
    console.log('[DEBUG] Payload to be sent:', payload);

    // Google Apps Script Web App으로 데이터 전송
    fetch(GOOGLE_APPS_SCRIPT_URL, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded' 
        },
        body: new URLSearchParams(payload) // URL 인코딩된 형태로 전송
    })
    .then(response => {
        console.log('Submission successful, status:', response.status, 'type:', response.type);
        console.log('If data is not saving, check Google Apps Script "Executions" logs.');

        // 성공적인 전송 후 팝업 표시 (ID: submissionModal 사용)
        document.getElementById('submissionModal').style.display = 'flex';
        
        // 팝업의 '결과 보기' 버튼 클릭 시 결과 페이지로 전환 (ID: closeModalBtn 사용)
        document.getElementById('closeModalBtn').onclick = () => {
            document.getElementById('submissionModal').style.display = 'none';
            showResultPage();
        };

        // 버튼 상태 복구
        submitBtn.disabled = false;
        submitBtn.textContent = '제출하기';
    })
    .catch(error => {
        // 네트워크 오류 처리
        console.error('Network Error:', error);
        
        submitBtn.disabled = false;
        submitBtn.textContent = '제출하기';
    });
});

/**
 * 차트 iframe HTML 구조를 생성합니다.
 */
function generateChartHtml(chartUrl, title) {
    return `
        <div class="mt-8 pt-4 border-t border-gray-200">
            <h3 class="text-xl font-semibold text-gray-800 mb-4 text-center">${title}</h3>
            <div class="chart-area mb-8 shadow-lg rounded-lg overflow-hidden border border-gray-300">
                <iframe 
                    src="${chartUrl}"
                    width="100%" 
                    height="450" 
                    frameborder="0" 
                    loading="lazy"
                    allowfullscreen>
                </iframe>
            </div>
        </div>
    `;
}

/**
 * 결과 페이지의 레이아웃(네비게이션, 차트, 정보)을 초기 설정합니다. (딱 한 번만 실행)
 */
function initializeResultLayout(resultSection) {
    // 1. Navigation Setup
    const navigationHtml = `
        <div id="resultNavigation" class="mb-8 flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-4 p-3 bg-gray-100 rounded-lg shadow-inner">
            <button id="navToCharts" class="nav-button bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200">
                📊 차트 결과 보기
            </button>
            <button id="navToInfo" class="nav-button bg-gray-400 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-lg transition duration-200">
                📜 패스트 패션 정보
            </button>
        </div>
    `;

    // 2. Chart Section Setup
    const chartHtml = `
        <div id="chartResults">
            <h2 class="text-3xl font-extrabold text-blue-800 text-center mb-6 pt-4">📊 설문조사 실시간 결과</h2>
            <p class="text-lg text-gray-700 text-center mb-8">
                Google Sheets에 수집된 설문조사 결과가 실시간으로 업데이트되는 그래프입니다.
            </p>
            
            <!-- 5개의 차트 섹션 -->
            ${generateChartHtml(CHART_EMBED_URL_Q1, "1. 옷을 얼마나 구매하시나요? (구매 빈도)")}
            ${generateChartHtml(CHART_EMBED_URL_Q2, "2. 한 번 구매 시 몇 벌을 구매하시나요? (구매 수량)")}
            ${generateChartHtml(CHART_EMBED_URL_Q3, "3. 주로 어디서 구매하시나요? (주요 구매처)")}
            ${generateChartHtml(CHART_EMBED_URL_Q4, "4. 구매한 옷은 얼마나 오래 입나요? (옷 수명)")}
            ${generateChartHtml(CHART_EMBED_URL_Q5, "5. 패스트 패션에 대해 어느정도 알고계시나요? (인식 수준)")}
            
            <p class="text-sm text-center text-gray-500 mt-2">차트는 Google Sheets의 데이터 업데이트 주기에 따라 반영됩니다.</p>
        </div>
    `;

    // 3. Info Section Setup (Enhanced Content)
    const infoHtml = `
        <div id="infoDetails" style="display: none;">
            <h2 class="text-3xl font-bold text-green-700 text-center mb-6 pt-4">📜 패스트 패션: 지속 가능성의 그림자</h2>
            <div class="space-y-6 text-gray-800 p-4 border rounded-lg bg-green-50">
                
                <h3 class="text-xl font-semibold text-green-600">1. 환경 오염 문제</h3>
                <p>
                    패스트 패션은 엄청난 양의 자원을 소모합니다. 특히 저렴한 합성 섬유인 폴리에스터는 제조 과정에서 석유를 사용하며, 세탁 시 미세 플라스틱을 배출하여 해양 생태계에 치명적인 영향을 줍니다. 또한 면화 생산에는 막대한 양의 물과 살충제가 필요하며, 짧은 주기로 버려지는 옷들은 매립지에서 분해되지 않고 환경에 장기적인 부담을 줍니다.
                </p>
                
                <h3 class="text-xl font-semibold text-green-600">2. 노동 착취 논란</h3>
                <p>
                    옷을 저렴하게, 그리고 빠르게 생산하기 위해 개발도상국의 노동자들은 비인간적인 환경에서 일하는 경우가 많습니다. 낮은 임금, 장시간 노동, 그리고 열악하고 위험한 작업 환경은 패스트 패션의 그림자입니다. 윤리적 소비가 강조되는 시대에, 소비자들은 자신이 입는 옷이 어떤 과정을 거쳐왔는지 주목할 필요가 있습니다.
                </p>
                
                <h3 class="text-xl font-semibold text-green-600">3. 과잉 소비 문화 조장</h3>
                <p>
                    패스트 패션은 '입을 옷이 없다'는 인식을 조장하며, 끊임없이 새로운 유행을 만들어 소비자가 불필요하게 옷을 구매하도록 유도합니다. 이로 인해 옷을 쉽게 버리는 습관이 생기고, 개인의 옷장뿐만 아니라 사회 전체의 지속 가능성에 악영향을 미칩니다. 옷의 가치를 존중하고 오래 입는 '슬로우 패션'으로의 전환이 중요해지고 있습니다.
                </p>
            </div>
            <p class="text-sm text-center text-gray-500 mt-8">자세한 정보는 관련 환경 및 노동 단체 자료를 참고하세요.</p>
        </div>
    `;

    resultSection.innerHTML = navigationHtml + chartHtml + infoHtml;

    // 네비게이션 버튼에 이벤트 리스너 연결
    document.getElementById('navToCharts').addEventListener('click', () => updateResultView('charts'));
    document.getElementById('navToInfo').addEventListener('click', () => updateResultView('info'));
}


/**
 * 현재 뷰 상태에 따라 화면을 전환하고 네비게이션 버튼 스타일을 업데이트합니다.
 */
function updateResultView(view) {
    currentView = view;
    const chartDiv = document.getElementById('chartResults');
    const infoDiv = document.getElementById('infoDetails');
    const navChartsBtn = document.getElementById('navToCharts');
    const navInfoBtn = document.getElementById('navToInfo');
    
    // 이 시점에서 요소가 존재한다고 가정 (initializeResultLayout이 호출된 후)

    if (view === 'charts') {
        chartDiv.style.display = 'block';
        infoDiv.style.display = 'none';
        
        // 차트 버튼 활성화 스타일
        navChartsBtn.classList.remove('bg-gray-400', 'hover:bg-gray-500');
        navChartsBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
        // 정보 버튼 비활성화 스타일
        navInfoBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
        navInfoBtn.classList.add('bg-gray-400', 'hover:bg-gray-500');
    } else { // view === 'info'
        chartDiv.style.display = 'none';
        infoDiv.style.display = 'block';

        // 차트 버튼 비활성화 스타일
        navChartsBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
        navChartsBtn.classList.add('bg-gray-400', 'hover:bg-gray-500');
        // 정보 버튼 활성화 스타일
        navInfoBtn.classList.remove('bg-gray-400', 'hover:bg-gray-500');
        navInfoBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
    }
    window.scrollTo(0, 0); 
}

/**
 * 설문조사 결과 페이지로 화면을 전환하고 Google Sheets의 차트를 표시합니다.
 */
function showResultPage() {
    // 설문 섹션 숨기기 (ID: surveySection 사용)
    document.getElementById('surveySection').style.display = 'none';
    
    const resultSection = document.getElementById('resultSection');
    
    // 결과 섹션 내용이 초기화되지 않았다면 초기 레이아웃을 설정합니다.
    if (resultSection.children.length === 0) {
        initializeResultLayout(resultSection);
    }
    
    // 결과 섹션 보이기
    resultSection.style.display = 'block';

    // 현재 뷰 상태에 따라 화면을 업데이트 (기본값: 'charts')
    updateResultView(currentView);
}
</script>
</body>
</html>
